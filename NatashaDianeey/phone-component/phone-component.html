<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<dom-module id="phone-component">
  <template>
    <style>
      :host {
        display: block;
      }
      .phone {
        border: 1px solid #000;
        min-height: 80vh;
      }
      .header {
        height: 30%;
        border-bottom: 1px solid #000;
        display: flex;
        flex-direction: row;
      }
      .battery {
        width: 30%;
        background-color: red;
      }
      iron-icon {
      --iron-icon-height: 32px;
      --iron-icon-width: 32px;
      }
      .low-battery {
        background-color: red;
      }
      .stable-battery {
        background-color: orange;
      }
      .full-battery {
        background-color: greenyellow;
      }
    </style>

      <div class="phone">
        <section class="header">
          <div class="battery" id="battery">
            <p>[[batteryStatus]]</p>
          </div>
          <div class="signal">
            <iron-icon icon="device:signal-cellular-4-bar"></iron-icon>
          </div>
        </section>
        <section class="body">
          <div class="player" id="player">
            <div class="player-header">
              <h3>Title</h3>
            </div>
            <div class="player-body">
              <dom-if if="[[!_isPlaying]]">
                <template>
                  <paper-button raised class="indigo" on-click="play">play</paper-button>
                </template>
              </dom-if>
              <dom-if if="[[_isPlaying]]">
                <template>
                  <paper-button raised class="indigo" on-click="stop">stop</paper-button>
                </template>
              </dom-if>
            </div>
          </div>
        </section>
      </div>

      <div class="control-charging">
        <paper-button raised class="indigo" on-click="charging">Charging</paper-button>
        <paper-button raised class="indigo" on-click="disconnected">Disconnected</paper-button>
      </div>

  </template>

  <script>
    /**
     * `phone-component`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class PhoneComponent extends Polymer.Element {
      static get is() { return 'phone-component'; }

      static get properties() {
        return {
          charging: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            notify: true,
            observer: '_manageCharging'
          },
          batteryStatus: {
            type: Number,
            value: 60,
            observer: '_setClassOfBattery'
          },
          _isPlaying: {
            type: Boolean,
            value: false,
            observer: '_manageCharging'
          }
        };
      }

      play() {
        this.dispatchEvent(new CustomEvent('phone-playing'));
        this.set('_isPlaying', true);

        const intervalTime = setInterval(() => {
          if (this.batteryStatus > 0) {
            this.set('batteryStatus', this.batteryStatus - 1);
          }
          localStorage.setItem('playing', `${intervalTime}`);
        }, 1000);
      }

      stop() {
        this.set('_isPlaying', false);
        clearInterval(localStorage.getItem('playing'));
      }


      charging() {
        // this.dispatchEvent(new CustomEvent('phone-charging', {
        //   bubbles: false,
        //   composed: false,
        //   detail: ''
        // }));
        // console.log('cargando');
      }
      

      _setClassOfBattery() {
        let batteryStatusClass = '';
        if (this.batteryStatus < 20) {
          batteryStatusClass = 'low-battery';
        }
        if (this.batteryStatus >= 20 && this.batteryStatus <= 80) {
          batteryStatusClass = 'stable-battery';
        }
        if (this.batteryStatus > 80) {
          batteryStatusClass = 'full-battery';
        }
        this.$.battery.classList.remove('low-battery', 'stable-battery', 'full-battery');
        this.$.battery.classList.add(batteryStatusClass);
      }

      _manageCharging() {
        if (this.charging) {
          const intervalTime = setInterval(() => {
            if (this.batteryStatus < 100) {
              this.set('batteryStatus', this.batteryStatus + 1);
            }
          }, 1000);
          localStorage.setItem('charging', `${intervalTime}`);
        } else {
          clearInterval(localStorage.getItem('charging'));
        }
      }
    }

    window.customElements.define(PhoneComponent.is, PhoneComponent);
  </script>
</dom-module>
